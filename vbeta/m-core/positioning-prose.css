/* .m-scene positioning
 * (div#vpage article#manuscript section.m-scene) 
 *
 * Scenes populate a prose manuscript. Crudely, it looks something like this:
 *
 * <div id="vpage"><article id="manuscript">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </article>
 * </div>
 *
 * … or, for example, two chapters …
 *
 * <div id="vpage"><article id="manuscript" class="long">
 * <section class="m-chapter">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </section>
 * <section class="m-chapter">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </section>
 * </article>
 * </div>
 *
 * Please reference the provided examples.
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


#manuscript {
    & section.m-scene {
        /*
         * Normal Scene: #manuscript section.m-scene:not(.foothang)
         */
        &:not(.foothang) {
            & p {
                /* a paragraph after a non-paragraph is not indented */
                text-indent: var(--m-indent-first-paragraph-scene);
            }
            & p ~ p {
                /* a paragraph after a paragraph is indented (narrative) or not
                 * (nonnarrative) */
                text-indent: var(--m-indent-scene);
                margin-top: var(--m-paragraph-spacing-scene);
                margin-block: var(--m-paragraph-spacing-scene) 0;
            }
            /* paragraphs - spacing between paragraphs in normal scenes
             *              indents at the start
             * Note, the exclusions are pedantic. */
            & > :is(h1,h2,h3,h4,h5,h6),
            & :not(.x-poem,.m-title-header, ol,ul,dl,menu, li,dt,dd, table,thead,tbody,tfoot,th,tr,td,colgroup,col) {
                & :is(h1,h2,h3,h4,h5,h6) {
                    margin-top: var(--m-elbow-room);
                    margin-block-start: var(--m-elbow-room);
                }
            }
        } /* end Normal Scene: #manuscript section.m-scene:not(.foothang) */


        /*
         * Scene's Subscenes - experimental. may go away.
         */

        /* ... subscenes: subscenes spacing BEFORE subscenes block */
        & > :not(div,section,article,h1,h2,h3,h4,h5,h6) ~ section.m-subscenes::before {
            content: var(--m-marker-zws); /* &zerowidthspace */
            margin-top: calc(var(--m-offset-scene) * 2);
        }
        /* ... subscenes: subscenes spacing AFTER subscenes block */
        & section.m-subscenes::after {
            content: var(--m-marker-zws); /* &zerowidthspace */
            margin-bottom: calc(var(--m-offset-scene) * 2);
        }

        & > section.m-subscenes:first-child,
        & section.m-subscenes {
            & > section.m-scene:first-child {
                padding-top: 0;
            }
            & > section.m-scene:last-child {
                /*padding-bottom: calc(var(--m-offset-scene) * 3);*/
                margin-bottom: 0;
                padding-bottom: 0;
            }
        }

        /*
         * Scene padding at the top
         */

        & > .m-title-header {
            /* prose content - there may be a small margin (non-narrative)
             * between prose content and a scene's header block if it exists */
            & ~ * {
                padding-top: var(--m-paragraph-spacing-scene);
            }
            /* all header content starts as centered and with no spacing */
            & > :is(h1, h2, h3, h4, h5, h6),   /* all header prose */
            & > p {                            /* all paragraphs */
                padding: 0; border: 0;
                text-align: center;
            }
            /* have to reset this because of the top-level .m-scene rules */
            & .m-facts {
                & > p {
                    text-indent: unset;
                    text-align: center;
                    margin-top: 0;
                    margin-block-start: 0;
                }
                & > p ~ p {
                    margin-top: var(--m-paragraph-spacing-scene);
                    margin-block-start: var(--m-paragraph-spacing-scene);
                }
            }
        }

        /*
         * Scene's last children are treated special-like
         */

        /* all last elements within a scene: zero-out bottom spacing */
        & > *:last-child {
            margin-bottom: 0; padding-bottom: 0;
        }
        /* all last elements within a scene: zero-out ::after content and spacing  */
        & > *:last-child::after {
            content: "";
            margin-top: 0; padding-top: 0;
            margin-bottom: 0; padding-bottom: 0;
        }
    } /* end #manuscript section.m-scene */

    /* scene title header spacing control
     * - gap between a scene header and its scene content */
    & section.m-scene > .m-title-header {
        margin-block-end: calc(var(--m-elbow-room) * 1);
    }
    & section.m-scene ~ section.m-scene:has( > .m-title-header) {
        margin-block-start: calc(var(--m-elbow-room) * 1);
    }


    /*
     * foothangs ------------
     */ 

    /* .m-scene or any other major block with a class .foothang
     * will format the paragraphs as foothangs */
    & :is(section,blockquote,div).foothang p {
        padding-left: var(--m-indent-foothang);
        /* hanging indent */
        text-indent: calc(var(--m-indent-foothang) * -1);
    }

} /* end #manuscript */

