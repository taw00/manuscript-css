/* base elements initialization and top-level positioning and spacing
 *
 * For the base elements stuff, this also includes some of the white-space and
 * overflow settings. I debate whether these should go in the fonts.css
 * stylesheet.
 *
 * For the top-level positioning and spacing, we define the rules governing
 * - title page titles, contacts, and counts
 * - the sections, titles, and beginning contact spacing
 *
 * Copyright (c) Todd Warner
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


#vpage {
    position: relative;
    top: 0;
    left: 0;
}


#manuscript {
    position: relative;
    overflow: hidden;
    top: 0;
    left: 0;

    text-align: var(--m-text-align);
    text-justify: var(--m-text-justify);

    & blockquote {
        border: 0; padding: 0;
        margin-block: var(--m-elbow-room);
        margin-inline: var(--m-margin-blockquote);
    }

    /* <hr> lines */
    & hr {
        border-top: 0;  border-bottom-width: 1px;
        border-left: 0; border-right: 0;
        width: 80%;
    }


    /*
     * H-TAG BASELINE RULES (h1 … h6)
     * - note, this gets refined later depending on where the tag lands
     */
    & :is(h1, h2, h3, h4, h5, h6) {
        margin: 0; padding: 0; border: 0;
        text-align: var(--m-text-align);
    }

    & :is(dd) {
        margin-inline-start: var(--m-indent);
    }


    /*
     * PARAGRAPH BASELINE RULES (p)
     * - note, this gets refined later depending on where the p lands
     */
    & p {
        padding: 0; border: 0;
        word-break: normal; overflow-wrap: break-word;
        /* a paragraph after a non-paragraph is not indented */
        text-indent: var(--m-indent-first-paragraph);
        text-align: var(--m-text-align);
        margin-block: 0;
    }
    & ul > li > p,
    & ol > li > p,
    & dt > dd > p,
    & dt > dd {
        text-indent: 0;
    }
    & p ~ p,
    & dd ~ dd {
        /* a paragraph after a paragraph is either indented (narrative)
         * or not indented (nonnarrative) */
        text-indent: var(--m-indent);
        margin-block: var(--m-paragraph-spacing) 0;
    }


    /*
     * PREFORMATTED RULES (pre and code)
     */
    & pre {
        margin-block: var(--m-paragraph-spacing);
        word-break: normal; overflow-wrap: break-word;
        white-space: pre-wrap; /* wrap */
    }
    & pre > code {
        white-space: pre; /* no wrap */
        overflow-x: auto; /* allow scroll bars (turned off for PDF/print in page.css) */
    }
    & :is(ol,ul,dl,menu, li,dt,dd, table,thead,tbody,tfoot,th,tr,td,colgroup,col) pre ~ pre {
        margin-block-start: 0;
    }
    & .m-title pre {
        margin-block: var(--m-nudge);
    }


    /*
     * TITLE PAGES - layout and orientation
     * (1st page title page and interior title pages "books")
     *
     * Title page itself is initialized in init/structure.css
     * Title page structure is 'display: grid' and 2x2
     *
     * Note: interior title pages are discovered via
     * :is(div.m-title-page,section) + div.m-title-page
     *
     * 1st page title page and "long" documents interior title pages
     * - page breaks above and below
     * - .m-contact - 1st row, 1st col, upper left-hand corner
     * - .m-count - 1st row, 2nd col,  upper right-hand corder (SHORT)
     *              or 2nd row, spanned, centered, bottom (LONG)
     * - .m-title - 1st row, spanned 2 cols, centered, top-margin-offset
     *
     * Interior pages title pages:
     * - For "long" documents, see above.
     * - For "short" documents, the interior title pages .m-contact, .m-count,
     *   .m-title will all occupy the samelevel with some seperation from the
     *   previous block of text.
     *
     * We use the grid model for the title pages. The flex model settings have
     * mostly been saved as commented out blocks of code in init/structure.css,
     * core/top-level.css, and core/poem.css
     */

    /* title page width and height */
    & div.m-title-page {
        width: 100%; max-width: 100%;
    }
    & > div.m-title-page {
        height: auto;
    }
    &:is(.long,.poetry) > div.m-title-page {
        height: var(--m-content-height);
    }
    &:is(.long,.poetry) > :is(div.m-title-page,section) + div.m-title-page {
        height: var(--m-content-height-interior);
    }

    & > div.m-title-page > div.m-contact,
    & > div.m-title-page > div.m-count,
    & > div.m-title-page > div.m-title,
    & div.xxxxxxxx {
        grid-row: 1;
    }
    & > div.m-title-page > div.m-contact {
        grid-column: 1;
    }
    & > div.m-title-page > div.m-count {
        grid-column: 2;
    }
    & > div.m-title-page > div.m-title {
        grid-column: 1 / -1;
        display: flex;
        justify-content: center;
        flex-direction: column;
    }
    &:is(.long,.poetry) > div.m-title-page > div.m-count {
        grid-column: 1 / -1;
        display: block;
        margin-block-start: auto;
        margin-inline: auto;
    }

    & .m-contact p {
        text-align: start;
        text-indent: unset;
        margin-block: 0;
    }
    & .m-count p {
        text-align: end;
        text-indent: unset;
        margin-block: 0;
    }

    &:is(.long,.poetry) > div.m-title-page .m-count p {
        text-align: center;
        text-indent: unset;
        margin-block: 0;
    }

    /*
     * POEM TITLE, CONTACT, COUNT layout and orientation
     */

    /* all poem blocks start as 'display: contents' and span both grid cols */
    & section.m-poem > * {
        grid-column: 1 / -1;
        display: contents;
        flex-direction: column;
    }

    & section.m-poem > div.m-contact,
    & section.m-poem > div.m-count,
    & section.m-poem > div.m-title,
    & div.xxxxxxxx {
        grid-row: 1;
    }
    & section.m-poem > div.m-contact {
        grid-column: 1;
    }
    & section.m-poem > div.m-count {
        grid-column: 2;
    }
    & section.m-poem > div.m-title {
        grid-column: 1 / -1;
        display: flex;
        justify-content: center;
        flex-direction: column;
    }

    /*
     * VERTICAL LAYOUT - page titles, parts, chapters, scenes, and poems
     */

    /*
     * spacing for 1st page title page
     */
    & > div.m-title-page > div.m-title {
        padding-block-start: var(--m-offset-title-page-title);
    }

    /*
     * short spacing
     */
    &:not(.long,.poetry) {
        & > :is(div.m-title-page,section) + div.m-title-page > div:is(.m-title, .m-contact, .m-count) {
            padding-block-start: var(--m-room-for-eight);
        }
        & > div.m-title-page + section > .m-title,
        & section:not(section.m-poem):has( > .m-title ) > .m-title,
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-four);
        }
        & section:has( > .m-title ) > section:first-of-type:has( > .m-title) > .m-title,
        & section:has( > .m-title ) > section:first-of-type:is(.m-scene),
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-four);
        }
        & section:is(.m-chapter):has( > .m-title ) > section:first-of-type:is(.m-scene) {
            padding-block-start: var(--m-room-for-two);
        }
        & section:has( > .m-title ) > section:first-of-type:is(.m-scene):has( > .m-title ) {
            padding-block-start: 0;
            & > .m-title {
                padding-block-start: var(--m-room-for-two);
            }
        }
    }

    /*
     * long spacing
     */
    &:is(.long,.poetry) {
        & > :is(div.m-title-page,section) + div.m-title-page > div.m-title {
            padding-block-start: var(--m-offset-interior-page-title);
        }

        & > div.m-title-page + section > .m-title,
        & section:not(section.m-poem):has( > .m-title ) > .m-title,
        & div.xxxxxxxx {
            padding-block-start: var(--m-offset-title);
        }
        & section:has( > .m-title ) > section:first-of-type:has( > .m-title) > .m-title,
        & section:has( > .m-title ) > section:first-of-type:is(.m-scene),
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-four);
        }
        & section:is(.m-chapter):has( > .m-title ) > section:first-of-type:is(.m-scene) {
            padding-block-start: var(--m-room-for-two);
        }
        & section:has( > .m-title ) > section:first-of-type:is(.m-scene):has( > .m-title ) {
            padding-block-start: 0;
            & > .m-title {
                padding-block-start: var(--m-room-for-two);
            }
        }
    }

    /*
     * poem spacing
     * Note, a poem in a manuscript should never be without contact & count but
     * if the work is just being shared … still, 1/4 offset is an aesthetic
     * choice.
     */
    /*& section.m-poem:has( > .m-contact, > .m-count ) > .m-title {*/
    & section.m-poem > .m-title {
        padding-block-start: var(--m-offset-title-poem);
    }


    /*
     * TITLE BLOCKS (.m-title) - configuration within
     */
    & .m-title {
        /* this should be, for a 8.5in page, about 77% */
        width: calc((var(--m-max-width-header) / var(--m-content-width)) * 100%);
        max-width: var(--m-max-width-header);

        margin-block: 0;
        margin-inline: auto;

        /* all header content starts as centered and with no spacing */
        & > :is(h1, h2, h3, h4, h5, h6),   /* all header H-tags */
        & > p {                            /* all header paragraphs */
            padding: 0; border: 0;
            margin-block: 0;
            margin-inline: auto;
            text-align: center;
            text-indent: unset;
        }
        & > p:first-of-type,
        & > pre:first-of-type {
            margin-block-start: var(--m-nudge);
        }

        /* the epigraphs */
        & > blockquote {
            width: max-content;
            max-width: min(var(--m-max-width-epigraph),100%);
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
            & p {
                text-indent: var(--m-indent-first-paragraph-epigraph);
            }
            & p ~ p {
                /* a paragraph after a paragraph is either indented (narrative)
                 * or not indented (nonnarrative) */
                text-indent: var(--m-indent);
                margin-block: var(--m-paragraph-spacing) 0;
            }
        }

        /* explicityly no top and bottom margins for first and last within
         * the title block */
        & > :first-child { margin-block-start: 0; }
        & > :last-child { margin-block-end: 0; }
    }


    /* TEXT-ONLY and SIMPLE
     *
     * #manuscript.text-only:
     *    removes all contact info, page & title headers, & counts
     * #manuscript.simple:
     *    removes the all page headers, contacts, & counts */
    &:is(.text-only) {
        & .m-title-page {
            display: none !important;
        }
    }
    &:is(.simple) {
        & .m-contact,
        & .m-count {
            display: none !important;
        }
        & > div.m-title-page > div.m-title {
            padding-block-start: var(--m-room-for-eight);
        }
    }

} /* end #manuscript */



/* KEPT FOR POSTERITY ------------------------------------------ */
    /* contact and count: if block-style parent containers
     * (I think this is a little wrong and will not work the way we wish
     * anyway without html restructuring) */
    /*
    & .m-contact {
        display: block;
        float: inline-start;
        margin-block: 0;
    }
    & section.m-poem .m-count,
    & > div.m-title-page .m-count {
        display: block;
        float: inline-end;
        margin-block: unset;
        margin-inline: unset;
    }
    &:is(.long,.poetry) > div.m-title-page .m-count {
        margin-inline: auto;
    }
    */

    /* contact and count: if flex-style parent containers */
    /*
    & .m-contact {
        position: absolute;
        inset-inline: 0 auto;
        margin-block: 0;
    }

    & section.m-poem .m-count,
    & > div.m-title-page .m-count {
        position: absolute;
        inset-inline: auto 0;
        margin-block: unset;
        margin-inline: unset;
    }
    &:is(.long,.poetry) > div.m-title-page .m-count {
        position: absolute;
        inset-block-start: auto;
        margin-block: unset;
        margin-inline: auto;
    }
    */


/* spacing based on elements and not title */
    /*
    &:not(.long,.poetry) {
        / * an aesthetic gap * /
        & > :is(div.m-title-page,section):has(.m-contact,.m-count) + div.m-title-page {
            padding-block-start: var(--m-page-margin);
        }
        */
        /*
        & > div.m-title-page + section,
        & section:has( > .m-title ),
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-two);
        }
        */
        /*
        & section > .m-title,
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-two);
        }
        */
    /*
    &:is(.long,.poetry) {
        & > :is(div.m-title-page,section) + div.m-title-page:has(.m-contact,.m-count) {
            padding-block-start: unset;
        }
        & > div.m-title-page + section,
        & section:has( > .m-title ),
        & div.xxxxxxxx {
            padding-block-start: var(--m-offset-title);
        }
        & section:has( > .m-title ) > section:first-of-type:has( > .m-title),
        & section:has( > .m-title ) > section:first-of-type.m-scene,
        & div.xxxxxxxx {
            padding-block-start: var(--m-room-for-four);
        }
        & section.m-chapter:has( > .m-title ) > section:first-of-type.m-scene {
            padding-block-start: var(--m-room-for-two);
        }
        & section.m-poem {
            padding-block-start: unset;
        }
    }
    */

