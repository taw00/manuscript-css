/* top-level contact and fact management, mostly positioning and spacing
 *
 * Also included are some of the white-space and overflow settings. I debate
 * whether these should go in the fonts.css stylesheet.
 *
 * Copyright (c) Todd Warner
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


#vpage {
    position: relative;
    top: 0;
    left: 0;
}


#manuscript {
    position: relative;
    overflow: hidden;
    top: 0;
    left: 0;

    text-align: var(--m-text-align);
    text-justify: var(--m-text-justify);

    & blockquote {
        border: 0; padding: 0;
        margin-block: var(--m-elbow-room);
        margin-inline: var(--m-margin-blockquote);
    }

    /* <hr> lines */
    & hr {
        border-top: 0;  border-bottom-width: 1px;
        border-left: 0; border-right: 0;
        width: 80%;
    }


    /*
     * H-TAG BASELINE RULES (h1 … h6)
     * - note, this gets refined later depending on where the tag lands
     */
    & :is(h1, h2, h3, h4, h5, h6) {
        margin: 0; padding: 0; border: 0;
        text-align: var(--m-text-align);
    }

    & :is(dd) {
        margin-inline-start: var(--m-indent);
    }


    /*
     * PARAGRAPH BASELINE RULES (p)
     * - note, this gets refined later depending on where the p lands
     */
    & p {
        padding: 0; border: 0;
        word-break: normal; overflow-wrap: break-word;
        /* a paragraph after a non-paragraph is not indented */
        text-indent: var(--m-indent-first-paragraph);
        text-align: var(--m-text-align);
        margin-block: 0;
    }
    & ul > li > p,
    & ol > li > p,
    & dt > dd > p,
    & dt > dd {
        text-indent: 0;
    }
    & p ~ p,
    & dd ~ dd {
        /* a paragraph after a paragraph is either indented (narrative)
         * or not indented (nonnarrative) */
        text-indent: var(--m-indent);
        margin-block: var(--m-paragraph-spacing) 0;
    }


    /*
     * PREFORMATTED RULES (pre and code)
     */
    & pre {
        margin-block: var(--m-paragraph-spacing);
        word-break: normal; overflow-wrap: break-word;
        white-space: pre-wrap; /* wrap */
    }
    & pre > code {
        /*white-space: inherit;
        overflow-x: inherit;*/
        white-space: pre; /* no wrap */
        overflow-x: auto; /* allow scroll bars (turned off for PDF/print in page.css) */
    }
    & :is(ol,ul,dl,menu, li,dt,dd, table,thead,tbody,tfoot,th,tr,td,colgroup,col)
      pre ~ pre {
        margin-block-start: 0;
    }
    & .m-title pre {
        margin-block: var(--m-nudge);
    }


    /*
     * TITLE PAGE STUFF
     * Title page structure defined in init/structure.css
     * Title page structure is display: grid and 2x2
     */

    /* contact block: set in first column and first row of the grid
     * (upper left corner) */
    & > div.m-title-page > div.m-contact {
        grid-column: 1;
        grid-row: 1;
    }
    /* count block: set in second column and first row of the grid — SHORT
     * (upper right corner) */
    & > div.m-title-page > div.m-count {
        grid-column: 2; /* Second column */
        grid-row: 1;    /* First row */
    }
    /* count block: center of spanned two columns, last row, bottom of grid — LONG
     * (bottom center of page) */
    &:is(.long,.poetry) > div.m-title-page > div.m-count {
        grid-column: 1 / -1;      /* Span across both columns */
        grid-row: 2;              /* Second row */
        display: block;           /* Set to block */
        margin-block-start: auto; /* Pushes item to bottom of the grid cell */
        margin-inline: auto;      /* Pushes item to bottom of the grid cell */
    }
    /* title flex box: center of spanned two columns, 2nd row, centered — not used
     * (centered on center of page) */
    &  > div.m-title-page > div.m-title {
        grid-column: 1 / -1;     /* Span across both columns */
        grid-row: 2;             /* Second row */
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center;     /* Center vertically */
        flex-direction: column;
    }
    /* title flex box: center of spanned two columns, 1st row, centered
     * (centered on top of page) */
    & > div.m-title-page > div.m-title {
        grid-column: 1 / -1;     /* Span across both columns */
        grid-row: 1;             /* First row */
        display: flex;
        justify-content: center; /* Center horizontally */
        flex-direction: column;
        margin-block: var(--m-offset-title) 0; /* default offset by X amount */
    }
    /* INTERIOR title flex box top margin: a page-margin of space — SHORT
     * (centered but margined down from top of page) */
    &:not(.long,.poetry) > :is(div.m-title-page,section) + div.m-title-page > div.m-title {
        margin-block: var(--m-page-margin) 0;
    }
    /* INTERIOR title flex box top margin (if exist contact/count): a page-margin x2 — SHORT
     * (centered but margined down from top of page a bit more) */
    &:not(.long,.poetry) > :is(div.m-title-page,section) + div.m-title-page:has(.m-contact,.m-count) > div.m-title {
        margin-block: calc(var(--m-page-margin) * 2) 0; /* short offset by page margin */
    }
    /* title flex box top margin: 5/12 of page — LONG
     * (centered but margined down from top of page a bit more) */
    &:is(.long,.poetry) > div.m-title-page > div.m-title {
        margin-block: var(--m-offset-title) 0; /* long offset by X amount */
    }



    /*
     * Title Page(s)
     * Maybe make "m-book" be a title page?
     */
    & div.m-title-page {
        width: 100%; max-width: 100%;
        border-block: transparent dashed 0.05px; /* stops margin collapse */
    }
    & > div.m-title-page {
        height: auto;
    }
    &:is(.long,.poetry) > div.m-title-page {
        height: var(--m-content-height);
    }
    &:is(.long,.poetry) > :is(div.m-title-page,section) + div.m-title-page {
        height: var(--m-content-height-interior);
    }

    /* document or interior title page contact info
     * positioned at upper left corner */
    & .m-contact {
        & p {
            text-align: start;
            text-indent: unset;
            line-height: var(--m-line-spacing-single);
            margin-block: 0;
        }
    }
    & > section.m-poem > .m-contact {
        position: absolute;
        inset-block: auto;
        inset-inline: 0 auto;
        margin-block: 0;
    }

    & > div.m-title-page .m-count {
        & p {
            text-align: end;
            text-indent: unset;
            margin-block: 0;
        }
    }
    &:is(.long,.poetry) > div.m-title-page .m-count {
        & p {
            text-align: center;
            text-indent: unset;
            margin-block: 0;
        }
    }




    /*
     * ALL TITLE BLOCKS (.m-title)
     * - all title headers a baseline
     */
    & .m-title {
        /* this should be, for a 8.5in page, or about 77% */
        width: calc((var(--m-max-width-header) / var(--m-content-width)) * 100%);
        max-width: var(--m-max-width-header);

        margin-block: 0;
        margin-inline: auto;

        /* if a header is followed by section … space! */
        &:has(+ section) {
            padding-block-end: var(--m-room-for-two);
        }

        /* all header content starts as centered and with no spacing */
        & > :is(h1, h2, h3, h4, h5, h6),   /* all header H-tags */
        & > p {                            /* all header paragraphs */
            padding: 0; border: 0;
            margin-block: 0;
            margin-inline: auto;
            text-align: center;
            text-indent: unset;
        }
        & > p:first-of-type,
        & > pre:first-of-type {
            margin-block-start: var(--m-nudge);
        }

        /* the epigraphs */
        & > blockquote {
            /* I would have preferred, width: min(max-content, 100%);, but it does
             * not work for some reason. Instead we use a min on the max-width */
            width: max-content;
            max-width: min(var(--m-max-width-epigraph),100%);
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
            & p {
                text-indent: var(--m-indent-first-paragraph-epigraph);
            }
            & p ~ p {
                /* a paragraph after a paragraph is either indented (narrative)
                 * or not indented (nonnarrative) */
                text-indent: var(--m-indent);
                margin-block: var(--m-paragraph-spacing) 0;
            }
        }

        /* explicityly no top and bottom margins for first and last */
        & > :first-child { margin-block-start: 0; }
        & > :last-child { margin-block-end: 0; }
    }


    /* TEXT-ONLY and SIMPLE
     *
     * #manuscript.text-only:
     *    removes all contact info, page & title headers, & counts
     * #manuscript.simple:
     *    removes the all page headers, contacts, & counts */
    &.text-only {
        .m-title-page {
            display: none !important;
        }
    }
    &.simple {
        .m-contact,
        .m-count {
            display: none !important;
        }
        .m-title-page > .m-title{
            margin-block: var(--m-room-for-two) 0;
        }
    }

} /* end #manuscript */

