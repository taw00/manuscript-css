/* The virtual page and then the page set to print/PDF.
 *
 * Copyright (c) Todd Warner
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


/* SCREEN: rendering to the screen
 *
 * - <html> is trans and <body> is themed
 * - We then add a pretty 3D virtual page (#vpage)
 * - configure the content container to hold the text within.
 *
 * Implemenation note: #vpage and #manuscript use a combination of position
 * box-sizing and overflow that cannot change or the layout gets weird (though
 * overflow could still be set to auto, theoretically.
 */
@media screen {
    html {
        background-color: transparent;
    }
    /* rendered view: "desktop" background that the manuscript page sits on */
    body {
        background-color: var(--m-desktop-color);
    }
    /* the virtual page â€” the paper */
    #vpage {
        width: 96%; max-width: var(--m-page-width);
        min-height: var(--m-page-height);
        background-color: var(--m-paper-color);
        box-shadow: var(--m-vpage-frame);
        margin: var(--m-vpage-frame-margin);

        /* We want the padding (page margin) to shrink on small screens */
        padding: min(var(--m-page-margin),var(--m-page-margin-min));
        /* the content container - the words and content, not the paper */
        & #manuscript {
            width: 100%; max-width: var(--m-content-width);
            border: var(--m-manuscript-border);
            margin-block: auto;
            margin-inline: auto;
        }

        /* experiment: flipping the padding/margin settings that set the
         * standard 1in margin around the content.
         *
         * The "flip" determines who, #vpage or #manuscript, governs the page
         * margin. If we think like a printer, the page margins should be
         * controlled by the paper/page and not the content. That's how it is
         * set by default: #vpage being the virtual-page. If you want to flip
         * this relationship, add 'flip-margins-experiment' to the #vpage
         * classes and then #manuscript with center the content and set its own
         * spacing with the margin settings. This will very likely go away. */
        &.flip-margins-experiment {
            padding: 0.02px; /* otherwise margins collapse */
            & #manuscript {
                width: 100%; max-width: var(--m-content-width);
                margin-block: var(--m-page-margin);
                margin-inline: auto;
            }
        }
    } /* end #vpage */

    /* Joplin Footnote styling - this is specific to Joplin */
    html:has(#vpage + hr.footnotes-sep) #vpage {
        /*padding-block-end: 0;*/ /* removes the page-margin */
        margin-block-end: 0; /* removes the framing gap */
        box-shadow: 0 -15px 20px -5px var(--m-vpage-frame-color);
    }
    #vpage + hr.footnotes-sep {
        display: none;
        border-color: var(--m-text-color);
        width: 96%;
        max-width: var(--m-content-width);
    }
    #vpage + hr.footnotes-sep + section.footnotes {
        box-sizing: border-box;
        color: var(--m-text-color);

        background-color: var(--m-paper-color);
        box-shadow: 0 15px 20px -5px var(--m-vpage-frame-color);
        width: 96%;
        max-width: var(--m-page-width);
        margin: 0 auto var(--m-vpage-frame-margin);
        padding-block: 10px var(--m-page-margin);
        & ol {
            box-sizing: border-box;
            border-block-start: 2px solid var(--m-text-color);
            margin-inline: var(--m-page-margin);
            padding-inline: 2rem 0;
        }
        & a {
            color: var(--m-link-color);
            text-decoration: unset;
            border: unset;
        }
        & a:hover {
            color: var(--m-link-hover-color);
        }
    }
} /* end @media screen */




/*
 * PRINT: rendering to PDF/paged-export
 */
@media print {
    html, body {
        width: 100%;
        max-width: 100%;
        border: 0;
        padding: 0;
        margin: 0;
        background-color: transparent;
    }
    #vpage, #manuscript {
        width: 100%;
        max-width: 100%;
        padding: 0;
        margin: 0;
        box-shadow: unset;
    }

    /* print rendering - do not allow code scrollbars */
    #manuscript pre > code { overflow: hidden; }

    /* marginalia rules (defined in m-init/marginalia.css) */
    #vpage {
        page: top-right-marginalia;
        &.no-marginalia,
        &:has(article#manuscript.poetry) {
            page: no-marginalia;
        }
        &.top-left-marginalia {
            page: top-left-marginalia;
        }
        &.top-center-marginalia {
            page: top-center-marginalia;
        }
        &.top-right-marginalia {
            page: top-right-marginalia;
        }
        &.bottom-left-marginalia {
            page: bottom-left-marginalia;
        }
        &.bottom-center-marginalia {
            page: bottom-center-marginalia;
        }
        &.bottom-right-marginalia {
            page: bottom-right-marginalia;
        }
    } /* end #vpage */

    /* Joplin Footnote styling - this is specific to Joplin */
    /* The page break avoidance measures do not work for some reason */
    html:has(#vpage + hr.footnotes-sep) #vpage {
        break-after: avoid-page !important;
    }
    #vpage + hr.footnotes-sep {
        break-before: avoid-page !important;
        display: none;
        width: var(--m-content-width);
    }
    #vpage + hr.footnotes-sep + section.footnotes {
        box-sizing: border-box;
        width: var(--m-content-width);
        padding: 0;
        margin-inline: auto;
        & ol {
            box-sizing: border-box;
            border-block-start: 2px solid var(--m-text-color-theme-default);
            margin-inline: auto;
            padding-inline: 2rem 0;
        }
        & a {
            color: var(--m-link-color-theme-default);
            text-decoration: unset;
            border: unset;
        }
        & a:hover {
            color: var(--m-link-hover-color-theme-default);
        }
    }
} /* end @media print */

