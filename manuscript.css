/* Manuscript via CSS v2.0
 *
 * Manuscript formatting for authors who draft in markdown.
 *
 * This stylesheet imports its companion -core.css logic stylesheet. The core
 * styles enable US letter-dimensioned short-prose narratives. This stylesheet
 * layers on functionality to enable A4-dimensioned documents, plus long-form
 * and both narrative and non-narrative formatting.
 *
 * Why does this exist?
 *
 * Because many of us writers draft in markdown and want a means to present our
 * work professionally, even if still a preliminary work. Additionally, it
 * offers a means to webify a finished manuscript.
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 *
 * The class "switches":
 * - 'US' & 'A4': US Letter is the default
 * - 'short' & 'long': a manuscript formatted for short prose is the default.
 * - 'narrative' & 'non-narrative': formatted for narrative prose is the
 *     default.
 *
 * To enable any of these formatting adjustments, just add the relevant
 * "switch" to the class attribute of the <div id="manuscript"> element in the
 * markdown document. 'A4' has one difference; you need to add an @page rule
 * after the CSS import call in the style block of the markdown.
 */

/* CSS layers not universally supported or honored by the various toolchains
 * yet. Commenting out for now. Probably for indefinately.
@layer manuscript {
*/

@import "./_manuscript-core.css";

@page {
    /* The default is already set for US letter.
     * For A4 you need to add this at-page declaration after your imports in
     * your markdown (or HTML) file's <style> block.
@page { size: A4 portrait; margin: 25.4mm; }
     */
}

#manuscript.US {
    /* the default is already set for .US */
}

#manuscript.A4 {
    --m-page-width:  var(--m-page-widthA4);
    --m-page-height: var(--m-page-heightA4);
    --m-page-margin: var(--m-page-marginA4);

    --m-content-width:  calc(var(--m-page-width) - calc(var(--m-page-margin) * 2));
    --m-content-height: calc(var(--m-page-height) - calc(var(--m-page-margin) * 2));
}

#manuscript.narrative {
    /* the default is already set for .narrative */
}

#manuscript.non-narrative {
    --m-font-family: var(--m-font-family-non-narrative);
    --m-font-family-preformatted: var(--m-font-family-non-narrative-preformatted);
    --m-font-family-code: var(--m-font-family-non-narrative-code);
    --m-indent: var(--m-indent-non-narrative);
    --m-paragraph-spacing: var(--m-paragraph-spacing-non-narrative);
}

#manuscript.short {
    /* the default is already set for .short */
}

#manuscript.long {
    --m-offset-title: var(--m-offset-title-long);
    --m-offset-parts-and-chapters: var(--m-offset-parts-and-chapters-long);
    --m-offset-parts-and-chapters-render: var(--m-offset-parts-and-chapters-render-long);
    --m-offset-scene: var(--m-offset-scene-long);

    --m-page-break-simulated: var(--m-page-break-simulated-long);
    --m-break-after: unset;

    --m-position-facts:     var(--m-position-facts-long);
    --m-top-facts:          var(--m-top-facts-long);
    --m-bottom-facts:       var(--m-bottom-facts-long);
    --m-left-facts:         var(--m-left-facts-long);
    --m-right-facts:        var(--m-right-facts-long);
    --m-margin-facts:       var(--m-margin-facts-long);
    --m-text-align-facts:   var(--m-text-align-facts-long);
    --m-line-spacing-facts: var(--m-line-spacing-facts-long);
}
@media print {
#manuscript.long {
    /* long-form print behavior:
     * major component page break & position 1/3rd to 5/12th down the page */
    --m-page-break-simulated: 0;
    --m-page-break: var(--m-page-break-long);
}
} /* /print */


/* ************************************************************************* */
/* * VALIDATION TESTS ****************************************************** */
/* ************************************************************************* */

/* checks for inverted section vs. div */
section#vpage::before, section#manuscript::before, section#m-contact::before,
section.m-header::before, sections.m-facts::before,
div.m-part::before, div.m-chapter::before, div.m-scene::before,
/* checks for inverted id vs. class */
.vpage::before, .manuscript::before, .m-contact::before,
#m-header::before, #m-facts::before,
#m-part::before, #m-chapter::before, #m-scene::before,
#manuscript#US::before, #manuscript#A4::before,
#manuscript#short::before, #manuscript#long::before,
#manuscript#narrative::before, #manuscript#non-narrative::before,
/* checks for mutually exclusive class values */
#manuscript.long.short::before, #manuscript.short.long::before,
#manuscript.narrative.non-narrative::before, #manuscript.non-narrative.narrative::before,
#manuscript.US.A4::before, #manuscript.A4.US::before,
/* check for incorrect positioning  */
#manuscript section.part > section.part::before, /* -- ALLOWED */
#manuscript section.chapter > section.part::before,
#manuscript section.scene > section.part::before,
#manuscript section.chapter > section.chapter::before,
#manuscript section.scene > section.chapter::before,
#manuscript section.scene > section.scene::before,
#manuscript.long > .m-facts::after {
    display: block; z-index: 999; opacity: 1;
    /*position: absolute; box-sizing: border-box; overflow: visible;
    top: 20px; left: 20px;*/
    color: red !important; background-color: rgb(20,20,20) !important;
    font-family: var(--m-fontstack-sans); font-weight: bold;
    text-align: center;
    width: 100%; max-width: 65%;
    margin: 0 auto; padding: 1em; border: 2px solid red;
    content: 'ERROR! Check your HTML. Either something should be a class when '
             'it is an id, or something should be a section when it is a div. '
             'Or the reverse. Or some element.class or element.id is position '
             'inside of the wrong container.';
}
/* checks for inverted section vs. div or id vs. class */
section#vpage::before, section#manuscript::before, section#m-contact::before,
.vpage::before, .manuscript::before, .m-contact::before {
    position: relative; box-sizing: border-box; overflow: visible;
    top: 1in; left: 1in;
    content: 'ERROR! section vs. div or id vs. class mismatch in your HTML. '
             'vpage, manuscript, and m-contact must be ids of div elements. '
             '<div id="..." ...>';
}
section.m-header::before, section.m-facts::before,
#m-header::before, #m-facts::before {
    position: relative; box-sizing: border-box; overflow: visible;
    top: 1in; left: 1in;
    content: 'ERROR! section vs. div or id vs. class mismatch in your HTML. '
             'm-header and m-facts must be classes of div elements. '
             '<div class="..." ...>';
}
div.m-part::before, div.m-chapter::before, div.m-scene::before,
#m-part::before, #m-chapter::before, #m-scene::before {
    content: 'ERROR! section vs. div or id vs. class mismatch in your HTML. '
         'm-part, m-chapter, and m-scene must be classes of section elements. '
         '<section class="..." ...>';
}

/* checks for inverted id vs. class in the #manuscript div element */
#manuscript#US::before, #manuscript#A4::before,
#manuscript#short::before, #manuscript#long::before,
#manuscript#narrative::before, #manuscript#non-narrative::before {
    content: 'ERROR! id vs. class mismatch in your HTML. ';
             'US, A4, short, long, narrative, and non-narrative must be '
             'classes and not ids of the #manuscript div element. '
             '<div id="manuscript" class="...">';
}

/* checks for mutually exclusive class values */
#manuscript.long.short::before, #manuscript.short.long::before,
#manuscript.narrative.non-narrative::before, #manuscript.non-narrative.narrative::before,
#manuscript.US.A4::before, #manuscript.A4.US::before {
    content: 'ERROR! mutually exclusive class values. '
             'Class values for the #manuscript div element can include '
             'A4 or US, short or long, narrative or non-narrative, not both';
}

/* check for incorrect positioning  */
#manuscript section.part > section.part::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-part"> should not be a child of another '
             '<section class="m-part">.';
}
#manuscript section.chapter > section.part::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-part"> should not be a child of a '
             '<section class="m-chapter">.';
}
#manuscript section.scene > section.part::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-part"> should not be a child of a '
             '<section class="m-scene">.';
}
#manuscript section.chapter > section.chapter::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-chapter"> should not be a child of another '
             '<section class="m-chapter">.';
}
#manuscript section.scene > section.chapter::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-chapter"> should not be a child of a '
             '<section class="m-scene">.';
}
#manuscript section.scene > section.scene::before {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<section class="m-scene"> should not be a child of another '
             '<section class="m-scene">.';
}

/* ... we only really care about this error for long-form documents */
#manuscript.long > .m-facts::after {
    content: 'ERROR! HTML container inside of the wrong container. '
             '<div class="m-facts"> should be located inside the top-level '
             '.m-header block below the title and things';
}

/* layers not universally supported by the various toolchains, sadly
}*/ /* end @layer manuscript */
