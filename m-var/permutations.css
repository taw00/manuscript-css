/* CSS for Manuscript Formating v3.0
 *
 * @layer lm-var-permuations
 *
 * This stylesheet will re-configuration variables found in m-var/defaults.css
 * to match switches fliped by the user. Paper-sizes, Narrative/Nonnarrative,
 * Short and Long forms, Prose versus Poetry, Simple renderings vs. not, etc.
 *
 * There are values in here that can be overridden, but others that really
 * should not be. Tread carefully.
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */

@layer lm-var-permutations {

:root {
    &:has(#vpage:is(.US,.us,.letter)) {
        --m-page-width:  var(--m-page-widthUS);
        --m-page-height: var(--m-page-heightUS);
        --m-page-margin: var(--m-page-marginUS);
        --m-indent-narrative: var(--m-indentUS);
        --m-indent-foothang:  var(--m-indentUS);
    }

    &:has(#vpage:is(.USh,.USH,.ush,.hletter)) { /* US half-letter */
        --m-page-width:  var(--m-page-widthUSh);
        --m-page-height: var(--m-page-heightUSh);
        --m-page-margin: var(--m-page-marginUSh);
        --m-indent-narrative: var(--m-indentUSh);
        --m-indent-foothang:  var(--m-indentUSh);
    }

    &:has(#vpage:is(.A4,.a4)) {
        --m-page-width:  var(--m-page-widthA4);
        --m-page-height: var(--m-page-heightA4);
        --m-page-margin: var(--m-page-marginA4);
        --m-indent-narrative: var(--m-indentA4);
        --m-indent-foothang:  var(--m-indentA4);
    }

    &:has(#vpage:is(.A5,.a5)) {
        --m-page-width:  var(--m-page-widthA5);
        --m-page-height: var(--m-page-heightA5);
        --m-page-margin: var(--m-page-marginA5);
        --m-indent-narrative: var(--m-indentA5);
        --m-indent-foothang:  var(--m-indentA5);
    }
    &:has(#vpage:is(.A6,.a6)) {
        --m-page-width:  var(--m-page-widthA6);
        --m-page-height: var(--m-page-heightA6);
        --m-page-margin: var(--m-page-marginA6);
        --m-indent-narrative: var(--m-indentA6);
        --m-indent-foothang:  var(--m-indentA6);
    }
    &:has(#vpage:is(.landscape) {
        --m-page-width:   var(--m-page-heightA5);
        --m-page-height:  var(--m-page-widthA5);
    }

    /* now, recalculate */
    --m-content-width: calc(var(--m-page-width) - calc(var(--m-page-margin) * 2));
    --m-content-height: calc(var(--m-page-height) - calc(var(--m-page-margin) * 2));
    --m-max-width-header: calc(var(--m-content-width) - calc(var(--m-page-margin) * 1.5));
    --m-max-width-epigraph: calc(var(--m-content-width) - calc(var(--m-page-margin) * 2));
    --m-page-offset-1-5th: calc(var(--m-page-height) / 5);
    --m-page-offset-1-4th: calc(var(--m-page-height) / 4);
    --m-page-offset-1-3rd: calc(var(--m-page-height) / 3); /* or 3.66666in US */
    --m-page-offset-5-12th: calc(var(--m-page-height) * 5 / 12); /* or 4.58333in US */
    --m-page-offset-half: calc(var(--m-page-height) / 2); /* or 5.5in US */
    --m-content-offset-1-5th: calc(var(--m-page-offset-1-5th) - var(--m-page-margin));
    --m-content-offset-1-4th: calc(var(--m-page-offset-1-4th) - var(--m-page-margin));
    --m-content-offset-1-3rd: calc(var(--m-page-offset-1-3rd) - var(--m-page-margin));
    --m-content-offset-5-12th: calc(var(--m-page-offset-5-12th) - var(--m-page-margin));
    --m-content-offset-half: calc(var(--m-page-offset-half) - var(--m-page-margin));
    --m-offset-title-short:        var(--m-content-offset-5-12th);
    --m-offset-title-short-poetry: var(--m-content-offset-1-5th);
    --m-offset-title-long:         var(--m-content-offset-5-12th);
    --m-offset-title-long-poetry:  var(--m-content-offset-5-12th);
    --m-offset-part-long:           var(--m-offset-title-long);
    --m-offset-chapter-long:        var(--m-offset-title-long);
    --m-margins-blockquote: calc(var(--m-indent-narrative) * 1.5);


    &:has(#manuscript:not(:is(.nonnarrative,.non-narrative))) { /* i.e., narrative */
        /* the default is already set for .narrative, but we are being explicit */
        /* narrative paragraphs first not indented, then indented */
        --m-indent: var(--m-indent-narrative);
        --m-indent-first-paragraph: var(--m-indent-narrative-first-paragraph);
        --m-paragraph-spacing: var(--m-paragraph-spacing-narrative);
        /* need to reset font-family for most everything */
        --m-font-family: var(--m-font-family-narrative);
        --m-font-family-preformatted: var(--m-font-family-narrative-preformatted);
        --m-font-family-code: var(--m-font-family-narrative-code);
    }

    &:has(#manuscript:is(.nonnarrative,.non-narrative)) {
        /* nonnarrative paragraphs are space-seperated and not indented */
        --m-indent: var(--m-indent-nonnarrative);
        --m-indent-first-paragraph: var(--m-indent-nonnarrative-first-paragraph);
        --m-paragraph-spacing: var(--m-paragraph-spacing-nonnarrative);
        /* need to reset font-family for most everything */
        --m-font-family: var(--m-font-family-nonnarrative);
        --m-font-family-preformatted: var(--m-font-family-nonnarrative-preformatted);
        --m-font-family-code: var(--m-font-family-nonnarrative-code);
    }

    /* reset font settings - the main title-block header */
    --m-font-family-header: inherit;
    --m-font-family-headers: inherit;
    /* reset font settings - contact info (and facts if put in the right corner */
    --m-font-family-contact: inherit;
    /* reset font settings - the main titles, subtitles, and authors */
    --m-font-family-title: inherit;
    --m-font-family-byline: inherit;
    /* reset font settings - part titles, subtitles, and authors */
    --m-font-family-title-part: inherit;
    --m-font-family-byline-part: inherit;
    /* reset font settings - chapter titles, subtitles, and authors */
    --m-font-family-title-chapter: inherit;
    --m-font-family-byline-chapter: inherit;
    /* reset font settings - scene titles, subtitles, and authors */
    --m-font-family-title-scene: inherit;
    --m-font-family-byline-scene: inherit;
    /* reset font settings - the epigraphs */
    --m-font-family-epigraph: inherit;
    /* reset font settings - the section separators (dinkus and -30-) */
    --m-font-family-dinkus-30-: inherit;

    /* reset font settings short/long - .m-fact */
    --m-font-family-facts-short:  var(--m-font-family-contact);
    --m-font-size-facts-short:    var(--m-font-size-contact);
    --m-font-weight-facts-short:  var(--m-font-weight-contact);
    --m-line-spacing-facts-short: var(--m-line-spacing-single);
    --m-font-family-facts-long:  inherit; /* will inherit from m-header */
    --m-font-size-facts-long:    inherit;
    --m-font-weight-facts-long:  inherit;
    --m-line-spacing-facts-long: var(--m-line-spacing-single);

    &:has(#manuscript:not(.long)) { /* short, the default, but let's be explicit */
        --m-offset-title: var(--m-offset-title-short);
        --m-offset-part: var(--m-offset-part-short);
        --m-offset-part-render: var(--m-offset-part-render-short);
        --m-offset-chapter: var(--m-offset-chapter-short);
        --m-offset-chapter-render: var(--m-offset-chapter-render-short);
        --m-offset-scene: var(--m-offset-scene-short);
        --m-offset-poem: var(--m-offset-poem-short);

        --m-position-facts:     var(--m-position-facts-short);
        --m-top-facts:          var(--m-top-facts-short);
        --m-bottom-facts:       var(--m-bottom-facts-short);
        --m-left-facts:         var(--m-left-facts-short);
        --m-right-facts:        var(--m-right-facts-short);
        --m-margin-facts:       var(--m-margin-facts-short);
        --m-text-align-facts:   var(--m-text-align-facts-short);
        --m-line-spacing-facts: var(--m-line-spacing-facts-short);

        --m-font-family-facts:  var(--m-font-family-facts-short);
        --m-font-size-facts:    var(--m-font-size-facts-short);
        --m-font-weight-facts:  var(--m-font-weight-facts-short);
    }
    &:has(#manuscript:is(.long)) {
        --m-offset-title: var(--m-offset-title-long);
        --m-offset-part: var(--m-offset-part-long);
        --m-offset-part-render: var(--m-offset-part-render-long);
        --m-offset-chapter: var(--m-offset-chapter-long);
        --m-offset-chapter-render: var(--m-offset-chapter-render-long);
        --m-offset-scene: var(--m-offset-scene-long);
        --m-offset-poem: var(--m-offset-poem-long);

        --m-position-facts:     var(--m-position-facts-long);
        --m-top-facts:          var(--m-top-facts-long);
        --m-bottom-facts:       var(--m-bottom-facts-long);
        --m-left-facts:         var(--m-left-facts-long);
        --m-right-facts:        var(--m-right-facts-long);
        --m-margin-facts:       var(--m-margin-facts-long);
        --m-text-align-facts:   var(--m-text-align-facts-long);
        --m-line-spacing-facts: var(--m-line-spacing-facts-long);

        --m-font-family-facts:  var(--m-font-family-facts-long);
        --m-font-size-facts:    var(--m-font-size-facts-long);
        --m-font-weight-facts:  var(--m-font-weight-facts-long);
    }

    &:has(#manuscript:is(.poetry)) {
        --m-font-family:  var(--m-font-family-poetry);
        --m-font-family-title: inherit;
        --m-font-family-title-poem:  inherit;
        --m-font-family-byline-poem: inherit;
        --m-offset-title: var(--m-offset-title-short-poetry);
        --m-offset-chapter: var(--m-offset-chapter-short-poetry);
    &:has(#manuscript:is(.poetry.long)) {
        --m-offset-title: var(--m-offset-title-long-poetry);
        --m-offset-chapter: var(--m-offset-chapter-long-poetry);
    }


    &:has(#manuscript:is(.text-only,.simple)) {
        --m-offset-title: 0;
    }
    &:has(#manuscript:is(.text-only)) {
        --m-page-break: unset !important;
        --m-page-break-simulated: 0px !important;
        --m-offset-part: var(--m-elbow-room) !important;
        --m-offset-chapter: var(--m-elbow-room) !important;
        --m-offset-part-render: var(--m-elbow-room) !important;
        --m-offset-chapter-render: var(--m-elbow-room) !important;
        --m-manuscript-border: 0px !important;
    }

} /* end :root (aka <html>) */


@media screen {
    :root {
        &:has(#manuscript:not(.long)) {
            /* the default, but let's be explicit */
            /* note, these are, more or less, no-op settings by default. For short
             * stories, we don't want to do forced page breaks anywhere. */
            --m-page-break: var(--m-page-break-short); /* unset */
            --m-page-break-simulated: var(--m-page-break-simulated-short); /* 0 */
            --m-page-break-simulated-padding: var(--m-page-break-simulated-padding-short); /* 0 */
        }
        &:has(#manuscript:is(.long)) {
            --m-page-break: var(--m-page-break-long);
            --m-page-break-simulated: var(--m-page-break-simulated-long);
            --m-page-break-simulated-padding: var(--m-page-break-simulated-padding-long);
        }
    }
} /* end @media screen */

@media print {
    :root {
        --m-desktop-color: transparent;
        --m-paper-color: transparent;
        --m-vpage-frame: 0;
        --m-vpage-frame-margin: 0;
        --m-page-margin: 0;
        &:has(#manuscript:not(.long)) {
            /* the default, but let's be explicit */
            /* short-form print behavior: if page break simulation was set for some
             * reason, we unset it. */
            --m-page-break-simulated: 0;
            --m-page-break-simulated-padding: 0;
            --m-page-break: var(--m-page-break-short);
        }
        &:has(#manuscript:is(.long)) {
            /* long-form print behavior: no longer simulated, there will be a page
             * after the title page header */
            --m-page-break-simulated: 0;
            --m-page-break-simulated-padding: 0;
            --m-page-break: var(--m-page-break-long);
        }
    }
} /* end @media print */

} /* end @layer lm-var-permutations */

