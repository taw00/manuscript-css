/* CSS for Manuscript Formating v3.0
 *
 * page break and simulated page break positioning
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


/*
 * SIMULATED PAGE BREAKS
 */
@media screen {
    #manuscript > .m-header:has( ~ section),
    #manuscript section.m-book > .m-header:has( ~ :is(section.m-book,section.m-part)) {
        /* the title page or book needs padding before a sim. page break */
        padding-block-end: var(--m-page-break-simulated-padding);
    }
    /* we always page break after the title page */
    #manuscript > .m-header ~ section,
    /* we always page break as we go into a book */
    #manuscript section.m-book:has( > .m-header),
    /* we always page break as we go into a page */
    #manuscript section.m-part:has( > .m-header),
    /* we page break into poems that come one after another */
    #manuscript.poetry section.m-poem,
    #manuscript section.m-poem ~ section {
        border-top: var(--m-page-break-simulated);
    }

    #manuscript section.m-book:has( > .m-header),
    #manuscript section.m-part:has( > .m-header) {
        padding-block-start: var(--m-offset-part-simulated);
    }
    #manuscript.poetry section.m-poem {
        padding-block-end: var(--m-room-for-two);
    }
    
} /* end @media screen */


/*
 * PAGE BREAKS
 */
@media print {
    #vpage, #manuscript {
        break-before: avoid-page !important;
    }
    /*
    #manuscript > .m-header {
        break-after: var(--m-page-break);
    }
    */
    /* we always page break after the title page */
    #manuscript > .m-header ~ section {
        break-before: var(--m-page-break);
    }
    /* book and part top margins (may be large (long) or small (short)) But
     * only if they have a title block, otherwise, it's assumed no margin */
    #manuscript section.m-book:has( > .m-header) {
        break-before: var(--m-page-break);
        margin-block-start: var(--m-offset-part);
        padding-block-start: 1px;
    }
    #manuscript section.m-part:has( > .m-header) {
        break-before: var(--m-page-break);
        margin-block-start: var(--m-offset-part);
        padding-block-start: 1px;
    }
    #manuscript.poetry section.m-poem {
        break-before: var(--m-page-break);
    }
    #manuscript.poetry section.m-poem ~ section.m-scene {
        break-before: var(--m-page-break);
    }
    
    /* AVOIDANCE */

    a { break-inside: avoid-page !important; }

    h1, h2, h3, h4, h5, h6 {
        break-inside: avoid-page !important;
        break-after: avoid-page !important;
    }

    img, figure {
        break-inside: avoid-page !important;
        break-after: avoid-page !important;
    }

    tr { break-inside: avoid-page !important; }


    /* avoid-page page break inside a poem stanza */
    #manuscript .x-poem pre,
    #manuscript section.m-poem pre {
        break-inside: avoid-page !important;
    }
    
    /* don't page break inside a title-block header */
    /*
    #manuscript :is(section.m-part,section.m-chapter,
                    section.m-scene,section.m-poem) > .m-header {
        break-inside: avoid-page !important;
    }
    */
    #manuscript .m-header {
        break-inside: avoid-page !important;
    }
    #manuscript .m-facts {
        break-inside: avoid-page !important;
    }
    /* don't page break before a dinkus or -30- marker */
    #manuscript section.m-scene::after,
    #manuscript::after,
    #manuscript h6 {
        break-before: avoid-page !important;
        break-inside: avoid-page !important;
    }
} /* end @media print */

