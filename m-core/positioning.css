/* CSS for Manuscript Formating v3.0
 *
 * top-level contact and fact location management; verticle and horizontal
 * positioning on the page of nearly everything; page-breaks and simulated
 * page-breaks.
 *
 * Also included are white-space and overflow setting. I debate whether these
 * should go in the fonts.css stylesheet.
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


#vpage {
    position: relative;
    top: 0;
    left: 0;
}


#manuscript {
    position: relative;
    overflow: hidden;
    top: 0;
    left: 0;

    text-align: var(--m-text-align);
    text-justify: var(--m-text-justify);

    & blockquote {
        border: 0; padding: 0;
        margin-block: var(--m-elbow-room);
        margin-inline: var(--m-margin-blockquote);
    }

    /* <hr> lines */
    & hr {
        border-top: 0;  border-bottom-width: 1px;
        border-left: 0; border-right: 0;
        width: 80%;
    }


    /*
     * H-TAG BASELINE RULES (h1 … h6)
     * - note, this gets refined later depending on where the tag lands
     */
    & :is(h1, h2, h3, h4, h5, h6) {
        margin: 0; padding: 0; border: 0;
        text-align: var(--m-text-align);
    }


    /*
     * PARAGRAPH BASELINE RULES (p)
     * - note, this gets refined later depending on where the p lands
     */
    & p {
        padding: 0; border: 0;
        word-break: normal; overflow-wrap: break-word;
        /* a paragraph after a non-paragraph is not indented */
        text-indent: var(--m-indent-first-paragraph);
        text-align: var(--m-text-align);
        margin-block: 0;
    }
    & p + p {
        /* a paragraph after a paragraph is either indented (narrative)
         * or not indented (nonnarrative) */
        text-indent: var(--m-indent);
        margin-block: var(--m-paragraph-spacing) 0;
    }


    /*
     * PREFORMATTED RULES (pre and code)
     */
    & pre {
        margin-block: var(--m-paragraph-spacing);
        word-break: normal; overflow-wrap: break-word;
        white-space: pre-wrap; /* wrap */
    }
    & pre > code {
        /*white-space: inherit;
        overflow-x: inherit;*/
        white-space: pre; /* no wrap */
        overflow-x: auto; /* allow scroll bars (turned off for PDF/print in page.css) */
    }
    & :is(ol,ul,dl,menu, li,dt,dd, table,thead,tbody,tfoot,th,tr,td,colgroup,col)
      pre + pre {
        margin-block-start: 0;
    }
    & .m-header pre {
        margin-block: var(--m-nudge);
    }


    /*
     * CONTACT INFO
     * - contact info goes in the upper-left corner
     *   (probably need to internationalize this?) */
    & #m-contact {
        position: absolute;
        top: 0; left: 0;
        p {
            text-align: var(--m-text-align);
            text-indent: unset;
        }
    }


    /*
     * ALL TITLE HEADERS (.m-header)
     * - all title headers and m-facts, a baseline
     */
    & .m-header {
        /* this should be, for a 8.5in page, or about 77% */
        width: calc(calc(var(--m-max-width-header)/var(--m-content-width))*100%);
        max-width: var(--m-max-width-header);

        margin-block: 0;
        margin-inline: auto;

        /* if a header is followed by section … space! */
        &:has(+ section) {
            margin-block-end: var(--m-room-for-two);
        }

        /* all header content starts as centered and with no spacing */
        & > :is(h1, h2, h3, h4, h5, h6),   /* all header H-tags */
        & > p {                            /* all header paragraphs */
            padding: 0; border: 0;
            margin-block: 0;
            margin-inline: auto;
            text-align: center;
            text-indent: unset;
        }
        & > p:first-of-type,
        & > pre:first-of-type {
            margin-block-start: var(--m-nudge);
        }
        /* word count, etc */
        & > .m-facts {
            position: relative;
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
            & p {
                text-align: center;
                text-indent: unset;
            }
        }

        /* the epigraphs */
        & > blockquote {
            /* I would have preferred, width: min(max-content, 100%);, but it does
             * not work for some reason. Instead we use a min on the max-width */
            width: max-content;
            max-width: min(var(--m-max-width-epigraph),100%);
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
        }

        /* explicityly no top and bottom margins for first and last */
        & > :first-child { margin-block-start: 0; }
        & > :last-child { margin-block-end: 0; }
    }


    /*
     * TOP-LEVEL TITLE HEADER (#manuscript > .m-header)
     * - Note: this title header's facts are different depending on which
     *   class is set in #manuscript: .short or .long.
     */
    & > .m-header {
        /* place the manu.title block 1/3 to 5/12 down the page & center it */
        margin-block: var(--m-offset-title) 0;
        margin-inline: auto;
        position: static; /* .m-facts has to be able to float */
        & > .m-facts {
            /* if #manuscript.long: static; unset unset auto auto; 0, auto.
             * if #manuscript.short: absolute; 0 0 auto auto; unset */
            position: var(--m-position-facts);
            inset: var(--m-top-facts) var(--m-right-facts) auto auto;
            margin-block: var(--m-margin-facts-verticle);
            margin-inline: var(--m-margin-facts-horizontal);
            & p {
                /* if #manuscript.long: center
                 * if #manuscript.short: end */
                text-align: var(--m-text-align-facts);
                text-indent: unset;
            }
        }
    }


    /*
     * DINKUSES and -30-
     * - dinkuses are placed between scenes
     * - -30- is placed at the end of the document
     */
    &::after,
    & > h6,                              /* manually inserted top-level -30- */
    /*& > section:last-of-type::after,*/               /* auto-inserted -30- */
    & section.m-scene::after,                        /* auto-inserted dinkus */
    & section.m-subscenes::before,                   /* auto-inserted dinkus */
    & section.m-subscenes::after,                    /* auto-inserted dinkus */
    & :not(section.m-scene) > h6 {         /* manually ins. between sections */
        position: relative;
        text-align: center;
    }
    /* -30- - a hack in an attempt to deal with a rendering oddity.
     * NOTE: poetry manuscripts do not use dinkus or -30- markers */
    &:not(.poetry,.text-only)::after {
        /* prevents (I think) the half-height characters
         * at bottoms of pages here and there. */
        padding-bottom: .5rem;
    }

    /* #manuscript.text-only: removes all contact info, .m-headers, & facts
     * #manuscript.simple: removes the top-level contacts and all facts */
    &.text-only {
        #m-contact,
        .m-facts,
        .m-header {
            display: none !important;
        }
    }
    &.simple {
        #m-contact,
        .m-facts {
            display: none !important;
        }
    }
} /* end #manuscript */

