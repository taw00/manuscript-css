/* CSS for Manuscript Formating v3.0
 *
 * prose stylings
 *
 * Note, 'prose' is the default. There is no configuration if you are writing
 * prose to differentiate it from poetry.
 *
 * Note, 'narrative' is the default. If you wish to format things to a
 * 'nonnarrative' standard, add the 'nonnarrative' class value to the
 * article#manuscript element in your document. See examples.
 *
 * Note, short form formatting is the default. If you want to format things
 * to a a more 'long' form standard, add the 'long' class value to the
 * article#manuscript element in your document. See examples.
 *
 * A prose manuscript is structured as a series of scenes. Crudely, it looks
 * something like this:
 *
 * <div id="vpage"><article id="manuscript">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </article>
 * </div>
 *
 * … or, for example, two chapters …
 *
 * <div id="vpage"><article id="manuscript" class="long">
 * <section class="m-chapter">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </section>
 * <section class="m-chapter">
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * <section class="m-scene"> …your words… </section>
 * </section>
 * </article>
 * </div>
 *
 * Please reference the provided examples.
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


/* each scene or a set of subscenes: small padding at top */
/*#manuscript section.m-subscenes,*/
#manuscript section.m-scene {
    padding-top: var(--m-offset-scene);
}
#manuscript section.m-scene:not(:first-child) {
    padding-top: 0;
}
/* prose content:
 * small margin between prose content and a scene's title block if it exists */
#manuscript section.m-scene > .m-header + * {
    padding-top: var(--m-elbow-room);
}

#manuscript section.m-scene > section.m-subscenes:first-child,
#manuscript section.m-subscenes > section.m-scene:first-child {
    padding-top: 0;
}
#manuscript section.m-subscenes > section.m-scene:last-child {
    /*padding-bottom: calc(var(--m-offset-scene) * 3);*/
    margin-bottom: 0;
    padding-bottom: 0;
}
/* ... subscenes: subscenes spacing BEFORE subscenes block */
#manuscript section.m-scene > :not(div,section,article,h1,h2,h3,h4,h5,h6) + section.m-subscenes::before {
    content: var(--m-marker-zws); /* &zerowidthspace */
    margin-top: calc(var(--m-offset-scene) * 2);
}
/* ... subscenes: subscenes spacing AFTER subscenes block */
#manuscript section.m-scene section.m-subscenes::after {
    content: var(--m-marker-zws); /* &zerowidthspace */
    margin-bottom: calc(var(--m-offset-scene) * 2);
}
/* all last elements within a scene: zero-out bottom spacing */
#manuscript section.m-scene > *:last-child {
    margin-bottom: 0; padding-bottom: 0;
}
/* all last elements within a scene: zero-out ::after content and spacing  */
#manuscript section.m-scene > *:last-child::after {
    content: "";
    margin-top: 0; padding-top: 0;
    margin-bottom: 0; padding-bottom: 0;
}


/* Align left/start all the prose */
#manuscript blockquote :is(h1,h2,h3,h4,h5,h6),
#manuscript section.m-scene :is(h1,h2,h3,h4,h5,h6),
#manuscript blockquote p,
#manuscript section.m-scene p {
    display: block;
    margin: 0; padding: 0; border: 0;
    text-align: var(--m-text-align);
    line-height: var(--m-line-spacing);
    hyphens: var(--m-hyphens);
    /* -- also, check out this future feature (still in a w3c draft)
    hyphenate-limit-chars: 6 3 2;
    hyphenate-limit-lines: 2;
    */
}

/* paragraph indentation / spacing for all the prose
 * (which one is enabled is determined by .narrative or .nonnarrative)
 * Note, the exclusions are pedantic. I am unsure why ol,ul,dl,menu,table
 * wasn't enough to stop the styling here. Also, headers that are free-floating
 * need some room, regardless of narrative or nonnarrative.*/
#manuscript blockquote > :is(h1,h2,h3,h4,h5,h6),
#manuscript blockquote :not(ol,ul,dl,menu,table) :is(h1,h2,h3,h4,h5,h6),
#manuscript section.m-scene:not(.foothang) > :is(h1,h2,h3,h4,h5,h6),
#manuscript section.m-scene:not(.foothang)
                       :not(.m-header, ol,ul,dl,menu, li,dt,dd,
                            table,thead,tbody,tfoot,th,tr,td,colgroup,col) :is(h1,h2,h3,h4,h5,h6) {
    margin-top: var(--m-elbow-room);
    margin-block-start: var(--m-elbow-room);
}

#manuscript blockquote > p,
#manuscript blockquote :not(ol,ul,dl,menu,table) p,
#manuscript section.m-scene:not(.foothang) > p,
#manuscript section.m-scene:not(.foothang)
                       :not(.m-header, ol,ul,dl,menu, li,dt,dd,
                            table,thead,tbody,tfoot,th,tr,td,colgroup,col) p {
    text-indent: var(--m-indent);
    margin-top: var(--m-paragraph-spacing);
    margin-block-start: var(--m-paragraph-spacing);
}

/* ... and treat paragraphs after certain classes/elements different */
#manuscript > :is(blockquote,h1,h2,h3,h4,h5,h6,img,figure,section) + p,
#manuscript :not(.foothang) :is(blockquote,h1,h2,h3,h4,h5,h6,img,figure,section) + p,
#manuscript :is(blockquote, section.m-scene:not(.foothang)) > p:first-of-type {
    text-indent: var(--m-indent-first-paragraph) !important;
}
#manuscript :is(section) :is(h1,h2,h3,h4,h5,h6) + p,
#manuscript :is(article) :is(h1,h2,h3,h4,h5,h6) + p,
#manuscript :is(article) :is(section) :is(h1,h2,h3,h4,h5,h6) + p,
#manuscript :is(section.m-scene)
  > :is(p:first-of-type,
        h1:first-child, h2:first-child, h3:first-child,
        h4:first-child, h5:first-child, h6:first-child) {
    margin-top: 0 !important;
    margin-block-start: 0 !important;
}

/* Foothang management
 * Note, this has to follow all of the previous blocks of css */
#manuscript :is(section,blockquote,div).foothang p {
    padding-left: var(--m-indent-foothang);
    /* hanging indent */
    text-indent: calc(var(--m-indent-foothang) * -1);
}



