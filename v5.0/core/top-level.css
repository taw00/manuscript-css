/* top-level contact and fact management, mostly positioning and spacing
 *
 * Also included are some of the white-space and overflow settings. I debate
 * whether these should go in the fonts.css stylesheet.
 *
 * Copyright (c) Todd Warner
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */


#vpage {
    position: relative;
    top: 0;
    left: 0;
}


#manuscript {
    position: relative;
    overflow: hidden;
    top: 0;
    left: 0;

    text-align: var(--m-text-align);
    text-justify: var(--m-text-justify);

    & blockquote {
        border: 0; padding: 0;
        margin-block: var(--m-elbow-room);
        margin-inline: var(--m-margin-blockquote);
    }

    /* <hr> lines */
    & hr {
        border-top: 0;  border-bottom-width: 1px;
        border-left: 0; border-right: 0;
        width: 80%;
    }


    /*
     * H-TAG BASELINE RULES (h1 … h6)
     * - note, this gets refined later depending on where the tag lands
     */
    & :is(h1, h2, h3, h4, h5, h6) {
        margin: 0; padding: 0; border: 0;
        text-align: var(--m-text-align);
    }

    & :is(dd) {
        margin-inline-start: var(--m-indent);
    }


    /*
     * PARAGRAPH BASELINE RULES (p)
     * - note, this gets refined later depending on where the p lands
     */
    & p {
        padding: 0; border: 0;
        word-break: normal; overflow-wrap: break-word;
        /* a paragraph after a non-paragraph is not indented */
        text-indent: var(--m-indent-first-paragraph);
        text-align: var(--m-text-align);
        margin-block: 0;
    }
    & ul > li > p,
    & ol > li > p,
    & dt > dd > p,
    & dt > dd {
        text-indent: 0;
    }
    & p ~ p,
    & dd ~ dd {
        /* a paragraph after a paragraph is either indented (narrative)
         * or not indented (nonnarrative) */
        text-indent: var(--m-indent);
        margin-block: var(--m-paragraph-spacing) 0;
    }


    /*
     * PREFORMATTED RULES (pre and code)
     */
    & pre {
        margin-block: var(--m-paragraph-spacing);
        word-break: normal; overflow-wrap: break-word;
        white-space: pre-wrap; /* wrap */
    }
    & pre > code {
        /*white-space: inherit;
        overflow-x: inherit;*/
        white-space: pre; /* no wrap */
        overflow-x: auto; /* allow scroll bars (turned off for PDF/print in page.css) */
    }
    & :is(ol,ul,dl,menu, li,dt,dd, table,thead,tbody,tfoot,th,tr,td,colgroup,col)
      pre ~ pre {
        margin-block-start: 0;
    }
    & .m-title pre {
        margin-block: var(--m-nudge);
    }


    /*
     * CONTACT INFO both first page m-contact and other pages m-contacts
     * - contact info goes in the upper-left corner
     *   (probably need to internationalize this?) */
    & .m-contact {
        float: left;
        margin-block: 0;
        & p {
            text-align: start;
            text-indent: unset;
            line-height: var(--m-line-spacing-single);
            margin-block: 0;
        }
    }

    /* document word and line Count */
    & > .m-count {
        float: var(--m-float-count);
        position: var(--m-position-count);
        inset: var(--m-top-count) var(--m-right-count) var(--m-bottom-count) var(--m-left-count);
        margin-block: unset;
        margin-inline: var(--m-margin-inline-count);
        & p {
            text-align: var(--m-text-align-count);
            text-indent: 0;
            margin-block: 0;
        }
    }



    /*
     * ALL TITLE BLOCKS (.m-title)
     * - all title headers and m-facts, a baseline
     */
    & .m-title {
        /* this should be, for a 8.5in page, or about 77% */
        width: calc((var(--m-max-width-header) / var(--m-content-width)) * 100%);
        max-width: var(--m-max-width-header);

        margin-block: 0;
        margin-inline: auto;

        /* if a header is followed by section … space! */
        &:has(+ section) {
            padding-block-end: var(--m-room-for-two);
        }

        /* all header content starts as centered and with no spacing */
        & > :is(h1, h2, h3, h4, h5, h6),   /* all header H-tags */
        & > p {                            /* all header paragraphs */
            padding: 0; border: 0;
            margin-block: 0;
            margin-inline: auto;
            text-align: center;
            text-indent: unset;
        }
        & > p:first-of-type,
        & > pre:first-of-type {
            margin-block-start: var(--m-nudge);
        }
        /* genre and extra info */
        & > .m-facts {
            position: relative;
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
            & p {
                text-align: center;
                text-indent: unset;
                margin-block: 0;
            }
        }

        /* the epigraphs */
        & > blockquote {
            /* I would have preferred, width: min(max-content, 100%);, but it does
             * not work for some reason. Instead we use a min on the max-width */
            width: max-content;
            max-width: min(var(--m-max-width-epigraph),100%);
            margin-block: var(--m-nudge) 0;
            margin-inline: auto;
            & p {
                text-indent: var(--m-indent-first-paragraph-epigraph);
            }
            & p ~ p {
                /* a paragraph after a paragraph is either indented (narrative)
                 * or not indented (nonnarrative) */
                text-indent: var(--m-indent);
                margin-block: var(--m-paragraph-spacing) 0;
            }
        }

        /* explicityly no top and bottom margins for first and last */
        & > :first-child { margin-block-start: 0; }
        & > :last-child { margin-block-end: 0; }
    }


    /*
     * TOP-LEVEL TITLE BLOCK (#manuscript > .m-title)
     */
    & > .m-title {
        /* place the manu.title block 1/3 to 5/12 down the page & center it */
        margin-block: var(--m-offset-title) 0;
        margin-inline: auto;
        position: static; /* to enable positioning .m-facts outside of */
        /* genre and extra info */
        & > .m-facts {
            position: relative;
            margin-block: var(--m-room-for-two) auto;
            margin-inline: auto;
            & p {
                text-align: center;
                text-indent: unset;
            }
        }
    }

    /* TEXT-ONLY and SIMPLE
     *
     * #manuscript.text-only:
     *    removes all contact info, page & title headers, & facts
     * #manuscript.simple:
     *    removes the all page headers, contacts, & facts */
    &.text-only {
        .m-title,
        .m-facts,
        .m-contact,
        .m-count {
            display: none !important;
        }
    }
    &.simple {
        .m-facts,
        .m-contact,
        .m-count {
            display: none !important;
        }
    }

} /* end #manuscript */

