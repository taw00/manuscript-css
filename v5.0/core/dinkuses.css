/* Dinkus and -30- content and permutations and positioning
 *
 * We include some switches …
 * - If article#manuscript.text-only — no dinkuses or -30- (and other things)
 * - If article#manuscript.no-dinkuses — no dinkuses
 * - If article#manuscript.no-30- — no -30- at The End
 * - If article#manuscript section.scene.no-dinkus — no dinkus for that scene
 * - If article#manuscript section.scene section.subscenes.no-dinkuses -
 * - If article#manuscript section.scene + section:not(.scene) - no dinkus
 * - If article#manuscript.poetry - no -30- since poetry collections don't use
 *      -30- markers for whatever reason.
 * - If section.poem - will not have a dinkus
 *
 * Copyright (c) Todd Warner
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit <http://creativecommons.org/licenses/by/4.0/>
 */

/*
 * this needs a cleanup!!!
 */


#manuscript:not(.text-only) {

    &::after,                                /* auto-inserted top-level -30- */
    & > h6,                              /* manually-inserted top-level -30- */
    & section.scene::after,                        /* auto-inserted dinkus */
    & section.subscenes::before,                   /* auto-inserted dinkus */
    & section.subscenes::after,                    /* auto-inserted dinkus */
    & section:not(.scene) > h6 {           /* manually-ins. within section */
        display: none;
        position: relative;
        text-align: center;
    }

    &::after,                                /* auto inserted top-level -30- */
    & > h6,                              /* manually inserted top-level -30- */
    & section.scene:has(+ section.scene)::after, /* auto-inserted dinkus */
    & section.subscenes::before,                   /* auto-inserted dinkus */
    & section.subscenes::after,                    /* auto-inserted dinkus */
    & section:not(.scene) > h6 {           /* manually ins. within section */
        display: block;
    }

    /* right now #manuscript-level classes no-dinkuses and hide-dinkuses do the
     * same thing */
    &:is(.hide-dinkuses,.no-dinkuses) section.scene::after {
        content: var(--m-marker-zws); /* &zerowidthspace */
    }

    &:not(.hide-dinkuses,.no-dinkuses) {
        & section.scene:not(.hide-dinkus,.no-dinkus)::after {
            content: var(--m-dinkus);
        }

        /* per scene dinkuses - automated content for between scenes */
        & section.scene:is(.hide-dinkus,.no-dinkus)::after,
        /* if the next section after a scene … is not a scene, remove the dinkus
         * (should this be display: none?) */
        & section.scene:has(+ section:not(.scene))::after {
            content: var(--m-marker-zws); /* &zerowidthspace */
        }

        /* SUBSCENES */

        & section.subscenes:is(.hide-dinkuses,.no-dinkuses) section.scene::after {
            content: var(--m-marker-zws); /* &zerowidthspace */
        }
        & section.subscenes:not(.hide-dinkuses,.no-dinkuses) {
            & section.scene:is(.hide-dinkus,.no-dinkus)::after {
                content: var(--m-marker-zws); /* &zerowidthspace */
            }
            & section.scene:not(.hide-dinkus,.no-dinkus,:last-of-type)::after {
                content: var(--m-dinkus-subscene);
            }
        }
    }

    /* -30- content
     * Note: poetry manuscripts do not use dinkus or -30- markers */
    &:not(.poetry,.no-30-,.no-30)::after {
        padding-block-start: var(--m-room-for-two);
        content: var(--m-30-);
        text-align: center;
    }

    /* -30- - a hack in an attempt to deal with a rendering oddity.
     * NOTE: poetry manuscripts do not use dinkus or -30- markers */
    &:not(.poetry,.text-only)::after {
        /* prevents (I think) the half-height characters
         * at bottoms of pages here and there. */
        padding-bottom: .5rem;
    }

} /* end #manuscript:not(.text-only) */

